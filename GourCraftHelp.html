<!DOCTYPE html>
<html>

<head>
    <title>Gourmand Crafting Helper</title>
    <script src="DevTools.js"></script>
    <!-- Css -->
    <style>
        .left {
            width: 50%;
            float: left;
        }

        .right {
            width: 50%;
            float: right;
        }

        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: rgb(37, 37, 37);
            color: white;
            text-align: center;
            border-top: black 10px solid;
            height: 150px;
        }

        .clickable:hover {
            cursor: pointer;
            color: #fff;
        }

        body {
            background-color: rgb(43, 43, 43);
            color: #ccc;
            padding: 1%;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        a {
            color: rgb(0, 132, 255);
        }
    </style>
    <!-- JavaScript -->
    <script>//Define some global scope variables
        const items = [
            { "name": "rubbish", "wiki": "https://rainworld.miraheze.org/wiki/rubbish" },
            { "name": "flashbang", "wiki": "https://rainworld.miraheze.org/wiki/flashbang" },
            { "name": "lantern", "wiki": "https://rainworld.miraheze.org/wiki/lantern" },
            { "name": "vulture Mask", "wiki": "https://rainworld.miraheze.org/wiki/vulture_Mask" },
            { "name": "pearl", "wiki": "https://rainworld.miraheze.org/wiki/pearl" },
            { "name": "spore puff", "wiki": "https://rainworld.miraheze.org/wiki/spore_puff" },
            { "name": "beehive", "wiki": "https://rainworld.miraheze.org/wiki/beehive" },
            { "name": "blue fruit", "wiki": "https://rainworld.miraheze.org/wiki/blue_fruit" },
            { "name": "neuron fly", "wiki": "https://rainworld.miraheze.org/wiki/neuron_fly" },
            { "name": "overseer eye", "wiki": "https://rainworld.miraheze.org/wiki/overseer_eye" },
            { "name": "bubble fruit", "wiki": "https://rainworld.miraheze.org/wiki/bubble_fruit" },
            { "name": "jellyfish", "wiki": "https://rainworld.miraheze.org/wiki/jellyfish" },
            { "name": "lilypuck", "wiki": "https://rainworld.miraheze.org/wiki/lilypuck" },
            { "name": "karma flower", "wiki": "https://rainworld.miraheze.org/wiki/karma_flower" },
            { "name": "grenade", "wiki": "https://rainworld.miraheze.org/wiki/grenade" },
            { "name": "mushroom", "wiki": "https://rainworld.miraheze.org/wiki/mushroom" },
            { "name": "cherrybomb", "wiki": "https://rainworld.miraheze.org/wiki/cherrybomb" },
            { "name": "slime mold", "wiki": "https://rainworld.miraheze.org/wiki/slime_mold" },
            { "name": "batnip", "wiki": "https://rainworld.miraheze.org/wiki/batnip" },
            { "name": "eggbug egg", "wiki": "https://rainworld.miraheze.org/wiki/eggbug_egg" },
            { "name": "noodlefly egg", "wiki": "https://rainworld.miraheze.org/wiki/noodlefly_egg" },
            { "name": "batfly", "wiki": "https://rainworld.miraheze.org/wiki/batfly" },
            { "name": "bubbleweed", "wiki": "https://rainworld.miraheze.org/wiki/bubbleweed" },
            { "name": "singularity bomb", "wiki": "https://rainworld.miraheze.org/wiki/singularity_bomb" },
            { "name": "fire egg", "wiki": "https://rainworld.miraheze.org/wiki/fire_egg" },
            { "name": "seed", "wiki": "https://rainworld.miraheze.org/wiki/seed" },
            { "name": "gooieduck", "wiki": "https://rainworld.miraheze.org/wiki/gooieduck" },
            { "name": "glow weed", "wiki": "https://rainworld.miraheze.org/wiki/glow_weed" },
            { "name": "dandelion peach", "wiki": "https://rainworld.miraheze.org/wiki/dandelion_peach" },
            { "name": "infant centipede", "wiki": "https://rainworld.miraheze.org/wiki/infant_centipede" },
            { "name": "vulture grub", "wiki": "https://rainworld.miraheze.org/wiki/vulture_grub" },
            { "name": "noodlefly", "wiki": "https://rainworld.miraheze.org/wiki/noodlefly" },
            { "name": "hazer", "wiki": "https://rainworld.miraheze.org/wiki/hazer" }];
        const crafts = [
            { a: 'rubbish', b: 'flashbang', out: 'lantern' },
            { a: 'rubbish', b: 'vulture mask', out: 'pearl' },
            { a: 'rubbish', b: 'spore puff', out: 'beehive' },
            { a: 'rubbish', b: 'blue fruit', out: 'flashbang' },
            { a: 'rubbish', b: 'neuron fly', out: 'overseer eye' },
            { a: 'rubbish', b: 'bubble fruit', out: 'jellyfish' },
            { a: 'rubbish', b: 'jellyfish', out: 'lilypuck' },
            { a: 'rubbish', b: 'lantern', out: 'flashbang' },
            { a: 'rubbish', b: 'karma flower', out: 'grenade' },
            { a: 'rubbish', b: 'mushroom', out: 'spore puff' },
            { a: 'rubbish', b: 'cherrybomb', out: 'grenade' },
            { a: 'rubbish', b: 'slime mold', out: 'lantern' },
            { a: 'rubbish', b: 'batnip', out: 'cherrybomb' },
            { a: 'rubbish', b: 'grenade', out: 'pearl' },
            { a: 'rubbish', b: 'beehive', out: 'spore puff' },
            { a: 'rubbish', b: 'eggbug egg', out: 'noodlefly egg' },
            { a: 'rubbish', b: 'noodlefly egg', out: 'batfly' },
            { a: 'rubbish', b: 'bubbleweed', out: 'cherrybomb' },
            { a: 'rubbish', b: 'overseer eye', out: 'pearl' },
            { a: 'rubbish', b: 'singularity bomb', out: 'fire egg' },
            { a: 'rubbish', b: 'fire egg', out: 'grenade' },
            { a: 'rubbish', b: 'seed', out: 'batfly' },
            { a: 'rubbish', b: 'gooieduck', out: 'beehive' },
            { a: 'rubbish', b: 'lilypuck', out: 'lantern' },
            { a: 'rubbish', b: 'glow weed', out: 'lantern' },
            { a: 'rubbish', b: 'dandelion peach', out: 'spore puff' },
            { a: 'rubbish', b: 'batfly', out: 'mushroom' },
            { a: 'rubbish', b: 'infant centipede', out: 'beehive' },
            { a: 'rubbish', b: 'vulture grub', out: 'lantern' },
            { a: 'rubbish', b: 'noodlefly', out: 'spore puff' },
            { a: 'rubbish', b: 'hazer', out: 'lilypuck' },
            { a: 'flashbang', b: 'vulture mask', out: 'pearl' },
            { a: 'flashbang', b: 'spore puff', out: 'mushroom' },
            { a: 'flashbang', b: 'blue fruit', out: 'slime mold' },
            { a: 'flashbang', b: 'neuron fly', out: 'overseer eye' },
            { a: 'flashbang', b: 'bubble fruit', out: 'jellyfish' },
            { a: 'flashbang', b: 'jellyfish', out: 'lilypuck' },
            { a: 'flashbang', b: 'lantern', out: 'glow weed' },
            { a: 'flashbang', b: 'karma flower', out: 'lantern' },
            { a: 'flashbang', b: 'mushroom', out: 'spore puff' },
            { a: 'flashbang', b: 'cherrybomb', out: 'lantern' },
            { a: 'flashbang', b: 'slime mold', out: 'lantern' },
            { a: 'flashbang', b: 'batnip', out: 'cherrybomb' },
            { a: 'flashbang', b: 'grenade', out: 'lantern' },
            { a: 'flashbang', b: 'beehive', out: 'cherrybomb' },
            { a: 'flashbang', b: 'eggbug egg', out: 'beehive' },
            { a: 'flashbang', b: 'noodlefly egg', out: 'vulture grub' },
            { a: 'flashbang', b: 'bubbleweed', out: 'cherrybomb' },
            { a: 'flashbang', b: 'overseer eye', out: 'pearl' },
            { a: 'flashbang', b: 'singularity bomb', out: 'fire egg' },
            { a: 'flashbang', b: 'fire egg', out: 'grenade' },
            { a: 'flashbang', b: 'seed', out: 'vulture grub' },
            { a: 'flashbang', b: 'gooieduck', out: 'lantern' },
            { a: 'flashbang', b: 'lilypuck', out: 'lantern' },
            { a: 'flashbang', b: 'glow weed', out: 'lantern' },
            { a: 'flashbang', b: 'dandelion peach', out: 'beehive' },
            { a: 'flashbang', b: 'batfly', out: 'mushroom' },
            { a: 'flashbang', b: 'infant centipede', out: 'beehive' },
            { a: 'flashbang', b: 'vulture grub', out: 'lantern' },
            { a: 'flashbang', b: 'noodlefly', out: 'spore puff' },
            { a: 'flashbang', b: 'hazer', out: 'glow weed' },
            { a: 'vulture mask', b: 'spore puff', out: 'pearl' },
            { a: 'vulture mask', b: 'blue fruit', out: 'pearl' },
            { a: 'vulture mask', b: 'neuron fly', out: 'overseer eye' },
            { a: 'vulture mask', b: 'bubble fruit', out: 'pearl' },
            { a: 'vulture mask', b: 'jellyfish', out: 'pearl' },
            { a: 'vulture mask', b: 'lantern', out: 'pearl' },
            { a: 'vulture mask', b: 'karma flower', out: 'pearl' },
            { a: 'vulture mask', b: 'mushroom', out: 'pearl' },
            { a: 'vulture mask', b: 'cherrybomb', out: 'pearl' },
            { a: 'vulture mask', b: 'slime mold', out: 'pearl' },
            { a: 'vulture mask', b: 'batnip', out: 'pearl' },
            { a: 'vulture mask', b: 'grenade', out: 'pearl' },
            { a: 'vulture mask', b: 'beehive', out: 'pearl' },
            { a: 'vulture mask', b: 'eggbug egg', out: 'pearl' },
            { a: 'vulture mask', b: 'noodlefly egg', out: 'vulture grub' },
            { a: 'vulture mask', b: 'bubbleweed', out: 'pearl' },
            { a: 'vulture mask', b: 'overseer eye', out: 'pearl' },
            { a: 'vulture mask', b: 'singularity bomb', out: 'fire egg' },
            { a: 'vulture mask', b: 'fire egg', out: 'grenade' },
            { a: 'vulture mask', b: 'seed', out: 'vulture grub' },
            { a: 'vulture mask', b: 'gooieduck', out: 'pearl' },
            { a: 'vulture mask', b: 'lilypuck', out: 'pearl' },
            { a: 'vulture mask', b: 'glow weed', out: 'pearl' },
            { a: 'vulture mask', b: 'dandelion peach', out: 'pearl' },
            { a: 'vulture mask', b: 'batfly', out: 'seed' },
            { a: 'vulture mask', b: 'infant centipede', out: 'seed' },
            { a: 'vulture mask', b: 'vulture grub', out: 'seed' },
            { a: 'vulture mask', b: 'noodlefly', out: 'seed' },
            { a: 'vulture mask', b: 'hazer', out: 'seed' },
        ];

        var selItem = null
        var available = []
        var mode = "ItemInfo"

    </script>
    <script>
        //Handles input and search narrowing down
        function input(searched) {
            //filter items and list them in html
            var filtered = items.filter(e => e.name.includes(searched))
            listSearch("FilteredItems", filtered.map(e => e.name))
        };

        function clicked(item) {
            if (mode == "ItemInfo") {
                setSelItem(item)
            } else {
                if (!available.some(e => e.item === item)) {
                    available.push({ item: item, amount: 1 })
                }
            }
        }
        //sets selItem to Item and shows item desc and info
        function setSelItem(item) {
            selItem = items.find(e => e.name == item)
            if (selItem == null) {
                document.getElementById("selItemData").innerHTML = ""
            } else {
                document.getElementById("selItemData").innerHTML =
                    "<h2>Selected item</h2><p id=\"Desc\"></p><div><div class='left'><h2>How to craft</h2><ul id=\"CraftFrom\"></ul></div><div class='right'><h2>Use it to craft</h2><ul id=\"CraftTo\"></ul></div></div>"
                document.getElementById("Desc").innerHTML = '<a href="'+ selItem.wiki + '">' + selItem.name + '</a><img src="' + selItem.img + '">'
                filter()
                //scroll it into wiew
                document.getElementById("CraftFrom").scrollIntoView(true, { behavior: "smooth" });
            }
        };
        //filter the crafts possible with the item+list in html and how to create the item+list them in html
        function filter() {
            var filtered = crafts.filter(e => ((e.a == selItem.name) || (e.b == selItem.name)));
            list('CraftTo', filtered.map(e => mapOnClickBC(
                (e.a == selItem.name) ? e.a : e.b, (e.a == selItem.name) ? e.b : e.a, e.out)))
            var filtered = crafts.filter(e => e.out == selItem.name);
            list("CraftFrom", filtered.map(e => mapOnClickAB(e.a, e.b, e.out)))
        };
        //maps on click jump events for items for B,C
        function mapOnClickBC(a, b, c) {
            return (
                `<span>${a}
                </span>+ <span class='clickable' onclick='setSelItem("${b}")'>${b}
                </span>= <span class='clickable' onclick='setSelItem("${c}")'>${c}</span>`
            )
        }
        //maps on click jump events for items for A,B
        function mapOnClickAB(a, b, c) {
            return (
                `<span class='clickable' onclick='setSelItem("${a}")'>${a}
                </span>+<span class='clickable' onclick='setSelItem("${b}")'>${b}
                </span>=<span>${c}</span>`
            )
        }
        //lists every element of value in tag ElId
        function list(ElId, value) {
            if (value.length > 0) {
                document.getElementById(ElId).innerHTML = "<li>" + (value).join("</li><li>") + '</li>'
            } else {
                document.getElementById(ElId).innerHTML = ""
            }
        }
        //lists values for the search - includes onclick jumps
        function listSearch(ElId, value) {
            if (value.length > 0) {
                document.getElementById(ElId).innerHTML = value.map(e => `<li><span class='clickable' onclick=\"clicked('${e}')\">${e}</span></li>`).join("")
            } else {
                document.getElementById(ElId).innerHTML = ""
            }
        }

        function craftableFrom(available) {
            //makes var "states" and add default state
            var states = [{ paths: null, availableItems: available }]
            //for loop  loop through every state (even the ones added during looping)
            for (let state = 0; state < states.length; state++) {
                //gets the items of the current state
                var items = states[state].availableItems
                //filtering crafts so only the ones posible on the current state stay
                let filteredCrafts = crafts.filter(
                    //some complexity in getting the variable "items" inside the lambda
                    (function (items) {
                        return recipe => items.includes(recipe.a) && items.includes(recipe.b);
                    })(items));
                //make a new state for every craft
                filteredCrafts.forEach(recipe => {
                    //shalow copy the array "items" to "tmp"
                    let tmp = [...items]
                    //delete the items used by the craft from the array "tmp"
                    tmp.splice((tmp.findIndex(i => i == recipe.a)), 1)
                    tmp.splice((tmp.findIndex(i => i == recipe.b)), 1)
                    //add the item given by the craft to the array "tmp"
                    tmp.push(recipe.out)
                    //put the new state in the "states" array
                    states.push({ paths: [{ recipe: recipe, from: state }], availableItems: tmp })
                });
            }
            return (states)
        }

        function setMode(newMode) {
            mode = newMode
        }
    </script>
</head>

<body>
    <h1>Gourmand Crafting Helper</h1>
    <input type="text" id="ItemSearch" placeholder="Item name.." style="background-color: rgb(43, 43, 43);color: #ddd;"
        oninput="input(this.value)" onload="input(this.value)">
    <section class="main">
        <ul id="FilteredItems"></ul>
        <div id="selItemData"></div>
        <div style="clear: both;padding-bottom: 150px;"></div>
    </section>
    <div class="footer">
        <h2>Usefull links/info</h2>
        <p>
            <a href="https://rain-world-map.github.io/map.html?slugcat=gourmand&region=SH&room=SH_GOR02">Interactive
                Map</a>/<a href="https://rainworld.miraheze.org/wiki/Gourmand">Gourmand Wiki</a><br>
            Crafting can be performed by holding the Up and Grab inputs while standing still.
        </p>
    </div>
    <dialog>

    </dialog>
</body>
<p onload="input('')"></p>
</html>