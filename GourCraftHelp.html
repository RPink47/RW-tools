<!DOCTYPE html>
<html>

<head>
    <title>Gourmand Crafting Helper</title>
    <script src="DevTools.js"></script>
    <!-- Css -->
    <style>
        .half {
            width: 50%;
            float: left;
        }

        .footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color: rgb(37, 37, 37);
            color: white;
            text-align: center;
            border-top: black 10px solid;
            height: 150px;
        }

        .clickable:hover {
            cursor: pointer;
            color: #fff;
        }

        body {
            background-color: rgb(43, 43, 43);
            color: #ccc;
            padding: 1%;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        a {
            color: rgb(0, 132, 255);
        }
    </style>
    <!-- JavaScript -->
    <script>//Define some global scope variables
        const items = [
            { "name": "Rubbish", "wiki": "https://rainworld.miraheze.org/wiki/Rubbish" },
            { "name": "Flashbang", "wiki": "https://rainworld.miraheze.org/wiki/Flashbang" },
            { "name": "Lantern", "wiki": "https://rainworld.miraheze.org/wiki/Lantern" },
            { "name": "Vulture Mask", "wiki": "https://rainworld.miraheze.org/wiki/Vulture_Mask" },
            { "name": "Pearl", "wiki": "https://rainworld.miraheze.org/wiki/Pearl" },
            { "name": "Spore Puff", "wiki": "https://rainworld.miraheze.org/wiki/Spore_Puff" },
            { "name": "Beehive", "wiki": "https://rainworld.miraheze.org/wiki/Beehive" },
            { "name": "Blue Fruit", "wiki": "https://rainworld.miraheze.org/wiki/Blue_Fruit" },
            { "name": "Neuron Fly", "wiki": "https://rainworld.miraheze.org/wiki/Neuron_Fly" },
            { "name": "Overseer Eye", "wiki": "https://rainworld.miraheze.org/wiki/Overseer_Eye" },
            { "name": "Bubble Fruit", "wiki": "https://rainworld.miraheze.org/wiki/Bubble_Fruit" },
            { "name": "Jellyfish", "wiki": "https://rainworld.miraheze.org/wiki/Jellyfish" },
            { "name": "Lilypuck", "wiki": "https://rainworld.miraheze.org/wiki/Lilypuck" },
            { "name": "Karma Flower", "wiki": "https://rainworld.miraheze.org/wiki/Karma_Flower" },
            { "name": "Grenade", "wiki": "https://rainworld.miraheze.org/wiki/Grenade" },
            { "name": "Mushroom", "wiki": "https://rainworld.miraheze.org/wiki/Mushroom" },
            { "name": "Cherrybomb", "wiki": "https://rainworld.miraheze.org/wiki/Cherrybomb" },
            { "name": "Slime Mold", "wiki": "https://rainworld.miraheze.org/wiki/Slime_Mold" },
            { "name": "Batnip", "wiki": "https://rainworld.miraheze.org/wiki/Batnip" },
            { "name": "Eggbug Egg", "wiki": "https://rainworld.miraheze.org/wiki/Eggbug_Egg" },
            { "name": "Noodlefly Egg", "wiki": "https://rainworld.miraheze.org/wiki/Noodlefly_Egg" },
            { "name": "Batfly", "wiki": "https://rainworld.miraheze.org/wiki/Batfly" },
            { "name": "Bubbleweed", "wiki": "https://rainworld.miraheze.org/wiki/Bubbleweed" },
            { "name": "Singularity Bomb", "wiki": "https://rainworld.miraheze.org/wiki/Singularity_Bomb" },
            { "name": "Fire Egg", "wiki": "https://rainworld.miraheze.org/wiki/Fire_Egg" },
            { "name": "Seed", "wiki": "https://rainworld.miraheze.org/wiki/Seed" },
            { "name": "Gooieduck", "wiki": "https://rainworld.miraheze.org/wiki/Gooieduck" },
            { "name": "Glow Weed", "wiki": "https://rainworld.miraheze.org/wiki/Glow_Weed" },
            { "name": "Dandelion Peach", "wiki": "https://rainworld.miraheze.org/wiki/Dandelion_Peach" },
            { "name": "Infant Centipede", "wiki": "https://rainworld.miraheze.org/wiki/Infant_Centipede" },
            { "name": "Vulture Grub", "wiki": "https://rainworld.miraheze.org/wiki/Vulture_Grub" },
            { "name": "Noodlefly", "wiki": "https://rainworld.miraheze.org/wiki/Noodlefly" },
            { "name": "Hazer", "wiki": "https://rainworld.miraheze.org/wiki/Hazer" }];
        const crafts = [
            { a: 'rubbish', b: 'flashbang', out: 'lantern' },
            { a: 'rubbish', b: 'vulture mask', out: 'pearl' },
            { a: 'rubbish', b: 'spore puff', out: 'beehive' },
            { a: 'rubbish', b: 'blue fruit', out: 'flashbang' },
            { a: 'rubbish', b: 'neuron fly', out: 'overseer eye' },
            { a: 'rubbish', b: 'bubble fruit', out: 'jellyfish' },
            { a: 'rubbish', b: 'jellyfish', out: 'lilypuck' },
            { a: 'rubbish', b: 'lantern', out: 'flashbang' },
            { a: 'rubbish', b: 'karma flower', out: 'grenade' },
            { a: 'rubbish', b: 'mushroom', out: 'spore puff' },
            { a: 'rubbish', b: 'cherrybomb', out: 'grenade' },
            { a: 'rubbish', b: 'slime mold', out: 'lantern' },
            { a: 'rubbish', b: 'batnip', out: 'cherrybomb' },
            { a: 'rubbish', b: 'grenade', out: 'pearl' },
            { a: 'rubbish', b: 'beehive', out: 'spore puff' },
            { a: 'rubbish', b: 'eggbug egg', out: 'noodlefly egg' },
            { a: 'rubbish', b: 'noodlefly egg', out: 'batfly' },
            { a: 'rubbish', b: 'bubbleweed', out: 'cherrybomb' },
            { a: 'rubbish', b: 'overseer eye', out: 'pearl' },
            { a: 'rubbish', b: 'singularity bomb', out: 'fire egg' },
            { a: 'rubbish', b: 'fire egg', out: 'grenade' },
            { a: 'rubbish', b: 'seed', out: 'batfly' },
            { a: 'rubbish', b: 'gooieduck', out: 'beehive' },
            { a: 'rubbish', b: 'lilypuck', out: 'lantern' },
            { a: 'rubbish', b: 'glow weed', out: 'lantern' },
            { a: 'rubbish', b: 'dandelion peach', out: 'spore puff' },
            { a: 'rubbish', b: 'batfly', out: 'mushroom' },
            { a: 'rubbish', b: 'infant centipede', out: 'beehive' },
            { a: 'rubbish', b: 'vulture grub', out: 'lantern' },
            { a: 'rubbish', b: 'noodlefly', out: 'spore puff' },
            { a: 'rubbish', b: 'hazer', out: 'lilypuck' },
            { a: 'flashbang', b: 'vulture mask', out: 'pearl' },
            { a: 'flashbang', b: 'spore puff', out: 'mushroom' },
            { a: 'flashbang', b: 'blue fruit', out: 'slime mold' },
            { a: 'flashbang', b: 'neuron fly', out: 'overseer eye' },
            { a: 'flashbang', b: 'bubble fruit', out: 'jellyfish' },
            { a: 'flashbang', b: 'jellyfish', out: 'lilypuck' },
            { a: 'flashbang', b: 'lantern', out: 'glow weed' },
            { a: 'flashbang', b: 'karma flower', out: 'lantern' },
            { a: 'flashbang', b: 'mushroom', out: 'spore puff' },
            { a: 'flashbang', b: 'cherrybomb', out: 'lantern' },
            { a: 'flashbang', b: 'slime mold', out: 'lantern' },
            { a: 'flashbang', b: 'batnip', out: 'cherrybomb' },
            { a: 'flashbang', b: 'grenade', out: 'lantern' },
            { a: 'flashbang', b: 'beehive', out: 'cherrybomb' },
            { a: 'flashbang', b: 'eggbug egg', out: 'beehive' },
            { a: 'flashbang', b: 'noodlefly egg', out: 'vulture grub' },
            { a: 'flashbang', b: 'bubbleweed', out: 'cherrybomb' },
            { a: 'flashbang', b: 'overseer eye', out: 'pearl' },
            { a: 'flashbang', b: 'singularity bomb', out: 'fire egg' },
            { a: 'flashbang', b: 'fire egg', out: 'grenade' },
            { a: 'flashbang', b: 'seed', out: 'vulture grub' },
            { a: 'flashbang', b: 'gooieduck', out: 'lantern' },
            { a: 'flashbang', b: 'lilypuck', out: 'lantern' },
            { a: 'flashbang', b: 'glow weed', out: 'lantern' },
            { a: 'flashbang', b: 'dandelion peach', out: 'beehive' },
            { a: 'flashbang', b: 'batfly', out: 'mushroom' },
            { a: 'flashbang', b: 'infant centipede', out: 'beehive' },
            { a: 'flashbang', b: 'vulture grub', out: 'lantern' },
            { a: 'flashbang', b: 'noodlefly', out: 'spore puff' },
            { a: 'flashbang', b: 'hazer', out: 'glow weed' },
            { a: 'vulture mask', b: 'spore puff', out: 'pearl' },
            { a: 'vulture mask', b: 'blue fruit', out: 'pearl' },
            { a: 'vulture mask', b: 'neuron fly', out: 'overseer eye' },
            { a: 'vulture mask', b: 'bubble fruit', out: 'pearl' },
            { a: 'vulture mask', b: 'jellyfish', out: 'pearl' },
            { a: 'vulture mask', b: 'lantern', out: 'pearl' },
            { a: 'vulture mask', b: 'karma flower', out: 'pearl' },
            { a: 'vulture mask', b: 'mushroom', out: 'pearl' },
            { a: 'vulture mask', b: 'cherrybomb', out: 'pearl' },
            { a: 'vulture mask', b: 'slime mold', out: 'pearl' },
            { a: 'vulture mask', b: 'batnip', out: 'pearl' },
            { a: 'vulture mask', b: 'grenade', out: 'pearl' },
            { a: 'vulture mask', b: 'beehive', out: 'pearl' },
            { a: 'vulture mask', b: 'eggbug egg', out: 'pearl' },
            { a: 'vulture mask', b: 'noodlefly egg', out: 'vulture grub' },
            { a: 'vulture mask', b: 'bubbleweed', out: 'pearl' },
            { a: 'vulture mask', b: 'overseer eye', out: 'pearl' },
            { a: 'vulture mask', b: 'singularity bomb', out: 'fire egg' },
            { a: 'vulture mask', b: 'fire egg', out: 'grenade' },
            { a: 'vulture mask', b: 'seed', out: 'vulture grub' },
            { a: 'vulture mask', b: 'gooieduck', out: 'pearl' },
            { a: 'vulture mask', b: 'lilypuck', out: 'pearl' },
            { a: 'vulture mask', b: 'glow weed', out: 'pearl' },
            { a: 'vulture mask', b: 'dandelion peach', out: 'pearl' },
            { a: 'vulture mask', b: 'batfly', out: 'seed' },
            { a: 'vulture mask', b: 'infant centipede', out: 'seed' },
            { a: 'vulture mask', b: 'vulture grub', out: 'seed' },
            { a: 'vulture mask', b: 'noodlefly', out: 'seed' },
            { a: 'vulture mask', b: 'hazer', out: 'seed' },
        ];

        var selItem = null
        var available = []
        var mode = "ItemInfo"


        function uniq(a) {
            var seen = {};
            return a.filter(function (item) {
                return seen.hasOwnProperty(item) ? false : (seen[item] = true);
            });
        }

        function setupTable() {
            var out = []
            crafts.forEach(e => {
                out.push(e.a)
                out.push(e.b)
            });
            out = (uniq(out))
            out = out.map(e => e.split(" ").map(e => e.charAt(0).toUpperCase() + e.slice(1)))

            out.forEach(e => {
                let tmp = (".col_" + e.join(""))
                sheet.insertRule(tmp + "{}");
                Object.defineProperty(RuleMap, e.join(" "), { value: getCssStyle(tmp) })
            });
        }
        function getCssStyle(selector) {
            const len = rules.length;
            for (let i = 0; i < len; i++) {
                if (rules[i].selectorText === selector) {
                    return rules[i];
                }
            }
            return null;
        }
        var RuleMap = {}
        const sheet = document.styleSheets[0];
        const rules = sheet.cssRules || sheet.rules;
        setupTable()
    </script>


    <script>
        //Handles input and search narrowing down
        function input(searched) {
            //filter items and list them in html
            var filtered = items.filter(e => e.name.includes(searched))
            listSearch("FilteredItems", filtered.map(e => e.name))
        };

        function clicked(item) {
            if (mode == "ItemInfo") {
                setSelItem(item)
            } else {
                if (!available.some(e => e.item === item)) {
                    available.push({ item: item, amount: 1 })
                }
            }
        }
        //sets selItem to Item and shows item desc and info
        function setSelItem(item) {
            selItem = items.find(e => e.name == item)
            if (selItem == null) {
                document.getElementById("selItemData").innerHTML = ""
            } else {
                document.getElementById("selItemData").innerHTML =
                    "<h2>Selected item</h2><p id=\"Desc\"></p><div><div class='half'><h2>How to craft</h2><ul id=\"CraftFrom\"></ul></div><div class='half'><h2>Use it to craft</h2><ul id=\"CraftTo\"></ul></div></div>"
                document.getElementById("Desc").innerHTML = ('<a href="' + (selItem.wiki || "") + '">' + selItem.name + '</a><img src="' + (selItem.img || "") + '">')
                filter()
                //scroll it into wiew
                document.getElementById("CraftFrom").scrollIntoView(true, { behavior: "smooth" });
            }
        };
        //filter the crafts possible with the item+list in html and how to create the item+list them in html
        function filter() {
            var filtered = crafts.filter(e => ((e.a.toLowerCase() == selItem.name.toLowerCase()) || (e.b.toLowerCase() == selItem.name.toLowerCase())));
            list('CraftTo', filtered.map(e => mapOnClickBC(
                (e.a.toLowerCase() == selItem.name.toLowerCase()) ? e.a : e.b, (e.a.toLowerCase() == selItem.name.toLowerCase()) ? e.b : e.a, e.out)))
            var filtered = crafts.filter(e => e.out.toLowerCase() == selItem.name.toLowerCase());
            list("CraftFrom", filtered.map(e => mapOnClickAB(e.a, e.b, e.out)))
        };
        //maps on click jump events for items for B,C
        function mapOnClickBC(a, b, c) {
            return (
                `<span>${a}
                </span>+ <span class='clickable' onclick='setSelItem("${b}")'>${b}
                </span>= <span class='clickable' onclick='setSelItem("${c}")'>${c}</span>`
            )
        }
        //maps on click jump events for items for A,B
        function mapOnClickAB(a, b, c) {
            return (
                `<span class='clickable' onclick='setSelItem("${a}")'>${a}
                </span>+ <span class='clickable' onclick='setSelItem("${b}")'>${b}
                </span>= <span>${c}</span>`
            )
        }
        //lists every element of value in tag ElId
        function list(ElId, value) {
            if (value.length > 0) {
                document.getElementById(ElId).innerHTML = "<li>" + (value).join("</li><li>") + '</li>'
            } else {
                document.getElementById(ElId).innerHTML = ""
            }
        }
        //lists values for the search - includes onclick jumps
        function listSearch(ElId, value) {
            if (value.length > 0) {
                document.getElementById(ElId).innerHTML = value.map(e => `<li><span class='clickable' onclick=\"clicked('${e}')\">${e}</span></li>`).join("")
            } else {
                document.getElementById(ElId).innerHTML = ""
            }
        }

        function craftableFrom(available) {
            //makes var "states" and add default state
            var states = [{ paths: null, availableItems: available }]
            //for loop  loop through every state (even the ones added during looping)
            for (let state = 0; state < states.length; state++) {
                //gets the items of the current state
                var items = states[state].availableItems
                //filtering crafts so only the ones posible on the current state stay
                let filteredCrafts = crafts.filter(
                    //some complexity in getting the variable "items" inside the lambda
                    (function (items) {
                        return recipe => items.includes(recipe.a) && items.includes(recipe.b);
                    })(items));
                //make a new state for every craft
                filteredCrafts.forEach(recipe => {
                    //shalow copy the array "items" to "tmp"
                    let tmp = [...items]
                    //delete the items used by the craft from the array "tmp"
                    tmp.splice((tmp.findIndex(i => i == recipe.a)), 1)
                    tmp.splice((tmp.findIndex(i => i == recipe.b)), 1)
                    //add the item given by the craft to the array "tmp"
                    tmp.push(recipe.out)
                    //put the new state in the "states" array
                    states.push({ paths: [{ recipe: recipe, from: state }], availableItems: tmp })
                });
            }
            return (states)
        }
        function setMode(newMode) {
            mode = newMode
        }
        function modal(modal, show) {
            if (show) {
                document.getElementById(modal).showModal()
            } else {
                document.getElementById(modal).close()
            }
        }
    </script>
</head>

<body onload="input('')">
    <h1>Gourmand Crafting Helper</h1>
    <input type="text" id="ItemSearch" placeholder="Item name.." style="background-color: rgb(43, 43, 43);color: #ddd;"
        oninput="input(this.value)" onload="input(this.value)">
    <button style="float: right;" onclick="modal('ItemTableM', true)">
        <div style="padding: 1mm;">Table</div>
    </button>
    <section class="main">
        <ul id="FilteredItems"></ul>
        <dialog id="ItemTableM" style="height: 85%; width: 85%;">
            <h2 style="text-align: center;">Interactive crafts table</h2>
            <p style="text-align: center;">Work in progres</p>
            <table></table>
            <p style="text-align: center;">
            <button onclick="modal('ItemTableM', false)">
                <div style="padding: 1mm;">Close</div>
            </button>
            </p>
        </dialog>
        <div id="selItemData"></div>
        <div style="clear: both;padding-bottom: 150px;"></div>
    </section>
    <div class="footer">
        <h2>Usefull links/info</h2>
        <p>
            <a href="https://rain-world-map.github.io/map.html?slugcat=gourmand&region=SH&room=SH_GOR02">Interactive
                Map</a>/<a href="https://rainworld.miraheze.org/wiki/Gourmand">Gourmand Wiki</a><br>
            Crafting can be performed by holding the Up and Grab inputs while standing still.
        </p>
    </div>
</body>

</html>